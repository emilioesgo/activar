<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Mascota | Huellitas Digitales</title>
    <style>
        :root { --primary: #2bb673; --bg: #f4f7f6; --text: #333; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 380px; text-align: center; }
        .pet-photo { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid var(--primary); margin: 0 auto 15px; display: none; cursor: pointer; }
        .pet-emoji { font-size: 70px; cursor: pointer; margin-bottom: 15px; display: block; }
        h1 { margin: 10px 0; color: var(--text); font-size: 28px; }
        .info-box { background: #fffbe6; border-left: 4px solid #ffe58f; padding: 15px; border-radius: 12px; text-align: left; margin-bottom: 25px; }
        .btn { display: block; width: 100%; padding: 16px; margin-bottom: 12px; border-radius: 12px; font-size: 17px; font-weight: bold; text-decoration: none; color: white; box-sizing: border-box; }
        .btn-call { background: #007bff; }
        .btn-wa { background: #25d366; }
    </style>
</head>
<body>

<div class="card">
    <div id="loading">Cargando perfil...</div>
    <div id="contenido" style="display: none;">
        <img id="foto-display" class="pet-photo" src="">
        <div id="emoji-display" class="pet-emoji">üêæ</div>
        <h1 id="nombre-display">Nombre</h1>
        <div class="info-box">
            <p id="mensaje-display" style="margin:0; color: #555;"></p>
        </div>
        <a id="btn-llamar" href="#" class="btn btn-call">üìû Llamar al Due√±o</a>
        <a id="btn-wa" href="#" target="_blank" class="btn btn-wa">üí¨ Enviar WhatsApp</a>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCqROIzmp2guo2XLbdYrSW3ujlUBc7ngOc",
        authDomain: "huellitas-digitales.firebaseapp.com",
        projectId: "huellitas-digitales",
        storageBucket: "huellitas-digitales.firebasestorage.app",
        messagingSenderId: "523935942496",
        appId: "1:523935942496:web:0bb3ad3b28c189345fc005"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const placaId = new URLSearchParams(window.location.search).get('id');

    async function cargar() {
        if(!placaId) return;
        const snap = await getDoc(doc(db, "placas", placaId));
        if(snap.exists()) {
            const data = snap.data();
            document.getElementById("nombre-display").innerText = data.mascota;
            document.getElementById("mensaje-display").innerText = data.mensaje || "Sin avisos m√©dicos.";
            document.getElementById("btn-llamar").href = "tel:" + data.telefono;
            document.getElementById("btn-wa").href = `https://wa.me/${data.telefono.replace(/\+/g,'')}?text=Hola, encontr√© a ${data.mascota}`;
            
            if(data.foto) {
                document.getElementById("foto-display").src = data.foto;
                document.getElementById("foto-display").style.display = "block";
                document.getElementById("emoji-display").style.display = "none";
            }

            // Atajo de 3 clics para editar
            let taps = 0;
            const target = data.foto ? document.getElementById("foto-display") : document.getElementById("emoji-display");
            target.onclick = () => {
                taps++;
                if(taps === 3) window.location.href = `editar.html?id=${placaId}`;
            };

            document.getElementById("loading").style.display = "none";
            document.getElementById("contenido").style.display = "block";
        }
    }
    cargar();
</script>
</body>
</html>
