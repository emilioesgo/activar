<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Mascota | Huellitas Digitales</title>
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <style>
        :root { --primary: #2bb673; --whatsapp: #25D366; --bg: #f0f2f5; --text: #2c3e50; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; color: var(--text); }
        
        .profile-card { background: white; width: 100%; max-width: 450px; min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        /* Cabecera con Foto */
        .photo-container { width: 100%; height: 350px; background: #ddd; position: relative; overflow: hidden; }
        #pet-photo { width: 100%; height: 100%; object-fit: cover; }
        
        .status-badge { position: absolute; bottom: 20px; left: 20px; background: var(--primary); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* Informaci√≥n */
        .info-content { padding: 30px; border-radius: 30px 30px 0 0; background: white; margin-top: -30px; position: relative; }
        h1 { margin: 0; font-size: 32px; color: var(--dark); }
        .breed { color: #888; font-size: 16px; margin-bottom: 20px; display: block; }

        .emergency-box { background: #fff5f5; border: 1px dashed #feb2b2; padding: 15px; border-radius: 15px; margin-bottom: 25px; }
        .emergency-box span { color: #c53030; font-weight: bold; font-size: 14px; display: block; margin-bottom: 5px; }

        /* Botones de Acci√≥n */
        .actions { display: grid; gap: 15px; }
        .btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 18px; border-radius: 15px; text-decoration: none; color: white; font-weight: bold; font-size: 18px; transition: 0.3s; }
        .btn-call { background: var(--primary); box-shadow: 0 5px 15px rgba(43,182,115,0.3); }
        .btn-wa { background: var(--whatsapp); box-shadow: 0 5px 15px rgba(37,211,102,0.3); }
        
        .btn:active { transform: scale(0.95); }

        footer { text-align: center; padding: 40px 20px; font-size: 12px; color: #aaa; }
        
        /* Shimmer effect para carga */
        .loading { text-align: center; padding: 50px; }
    </style>
</head>
<body>

<div id="loading-view" class="loading">
    <img src="assets/img/logo.png" width="80" style="margin-bottom: 20px; opacity: 0.5;">
    <p>Buscando informaci√≥n de la mascota...</p>
</div>

<div id="profile-view" class="profile-card" style="display: none;">
    <div class="photo-container">
        <img id="pet-photo" src="https://images.unsplash.com/photo-1543466835-00a7907e9de1?auto=format&fit=crop&q=80&w=1000" alt="Mascota">
        <div class="status-badge">üõ°Ô∏è Protegido por Huellitas</div>
    </div>

    <div class="info-content">
        <h1 id="pet-name">Cargando...</h1>
        <span class="breed">Placa ID: <span id="display-id">---</span></span>

        <div class="emergency-box">
            <span>‚ö†Ô∏è NOTA DEL DUE√ëO:</span>
            <p id="pet-msg" style="margin: 0; font-size: 15px;">Si me encuentras, por favor contacta a mi familia lo antes posible. ¬°Gracias!</p>
        </div>

        <div class="actions">
            <a href="#" id="call-link" class="btn btn-call">
                üìû Llamar al Due√±o
            </a>
            <a href="#" id="wa-link" class="btn btn-wa">
                üí¨ Enviar WhatsApp
            </a>
        </div>
    </div>

    <footer>
        <img src="assets/img/logo.png" width="30" style="margin-bottom: 10px; filter: grayscale(1);"><br>
        <b>Huellitas Digitales</b><br>
        ¬øQuieres una placa como esta? Visita nuestro sitio.<br>
        <a href="admin.html" style="color: #ccc; text-decoration: none; margin-top: 10px; display: inline-block;">Acceso Admin</a>
    </footer>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCqROIzmp2guo2XLbdYrSW3ujlUBc7ngOc",
        authDomain: "huellitas-digitales.firebaseapp.com",
        projectId: "huellitas-digitales",
        storageBucket: "huellitas-digitales.firebasestorage.app",
        messagingSenderId: "523935942496",
        appId: "1:523935942496:web:0bb3ad3b28c189345fc005"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadProfile() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        if (!id) {
            window.location.href = "404.html";
            return;
        }

        try {
            const docRef = doc(db, "placas", id.toUpperCase());
            const docSnap = await getDoc(docRef);

            if (docSnap.exists() && docSnap.data().activa) {
                const data = docSnap.data();
                
                // Llenar datos
                document.getElementById("pet-name").innerText = data.mascota;
                document.getElementById("display-id").innerText = id.toUpperCase();
                
                if(data.mensaje) document.getElementById("pet-msg").innerText = data.mensaje;
                if(data.foto) document.getElementById("pet-photo").src = data.foto;

                // Configurar enlaces de contacto
                document.getElementById("call-link").href = `tel:${data.telefono}`;
                document.getElementById("wa-link").href = `https://wa.me/${data.telefono.replace(/\+/g, '').replace(/\s/g, '')}?text=Hola,%20encontr√©%20a%20tu%20mascota%20${data.mascota}.%20Escane√©%20su%20placa%20QR.`;

                // Mostrar perfil
                document.getElementById("loading-view").style.display = "none";
                document.getElementById("profile-view").style.display = "block";
            } else {
                window.location.href = "404.html";
            }
        } catch (e) {
            console.error(e);
            alert("Error al cargar los datos.");
        }
    }

    loadProfile();
</script>

</body>
</html>
