<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Mascota</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 350px; text-align: center; }
        #pet-img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid #2bb673; margin-bottom: 15px; display: none; }
        .huella { font-size: 80px; cursor: pointer; }
        .btn { display: block; padding: 15px; margin: 10px 0; border-radius: 10px; color: white; text-decoration: none; font-weight: bold; }
        .btn-call { background: #007bff; }
        .btn-wa { background: #25d366; }
    </style>
</head>
<body>
<div class="card">
    <img id="pet-img" src="">
    <div id="huella-icon" class="huella">üêæ</div>
    <h1 id="pet-name">Cargando...</h1>
    <p id="pet-msg" style="background: #fffbe6; padding: 10px; border-radius: 10px;"></p>
    <a id="call-link" href="#" class="btn btn-call">üìû Llamar al Due√±o</a>
    <a id="wa-link" href="#" class="btn btn-wa">üí¨ Enviar WhatsApp</a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { /* Mismo config de arriba */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const placaId = new URLSearchParams(window.location.search).get('id');

    async function load() {
        const snap = await getDoc(doc(db, "placas", placaId));
        if(snap.exists()) {
            const d = snap.data();
            document.getElementById("pet-name").innerText = d.mascota;
            document.getElementById("pet-msg").innerText = d.mensaje || "Sin avisos m√©dicos.";
            if(d.foto) {
                document.getElementById("pet-img").src = d.foto;
                document.getElementById("pet-img").style.display = "inline-block";
                document.getElementById("huella-icon").style.display = "none";
            }
            document.getElementById("call-link").href = "tel:" + d.telefono;
            document.getElementById("wa-link").href = `https://wa.me/${d.telefono.replace(/\+/g,'')}?text=Encontr√© a ${d.mascota}`;
            
            // Atajo: 3 clics en la huella/foto para editar
            let taps = 0;
            const trigger = d.foto ? document.getElementById("pet-img") : document.getElementById("huella-icon");
            trigger.onclick = () => {
                taps++;
                if(taps === 3) window.location.href = `editar.html?id=${placaId}`;
            };
        }
    }
    load();
</script>
</body>
</html>
