<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario | Huellitas Digitales</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 50px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 350px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-weight: bold; text-transform: uppercase; }
        button { width: 100%; padding: 12px; background: #2bb673; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 15px; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

<div class="card">
    <h2>Registrar Nueva Placa</h2>
    <p style="font-size: 12px; color: #666;">El ID ser√° creado como <b>No Pagado</b> y <b>No Activo</b> por seguridad.</p>
    
    <input type="text" id="placa-id" placeholder="Ej: BB7D1F" maxlength="6">
    <button id="btn-registrar">Subir a Inventario</button>
    
    <div id="status"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCqROIzmp2guo2XLbdYrSW3ujlUBc7ngOc",
        authDomain: "huellitas-digitales.firebaseapp.com",
        projectId: "huellitas-digitales",
        storageBucket: "huellitas-digitales.firebasestorage.app",
        messagingSenderId: "523935942496",
        appId: "1:523935942496:web:0bb3ad3b28c189345fc005"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById("btn-registrar").onclick = async () => {
        const id = document.getElementById("placa-id").value.trim().toUpperCase();
        const status = document.getElementById("status");

        if (id.length < 5) {
            status.innerText = "‚ùå ID demasiado corto.";
            return;
        }

        try {
            status.innerText = "‚è≥ Registrando...";
            
            // USAMOS setDoc PARA CREAR EL DOCUMENTO DESDE CERO
            await setDoc(doc(db, "placas", id), {
                id: id,
                activa: false,   // üîì El cliente a√∫n no pone sus datos
                pagada: false,   // üö´ Bloqueada comercialmente hasta que pase por caja
                fechaCreacion: serverTimestamp(),
                // Dejamos los dem√°s campos vac√≠os o inexistentes hasta la activaci√≥n
                mascota: "",
                telefono: "",
                pin: ""
            });

            status.innerHTML = `<b style="color:green;">‚úÖ ID ${id} registrado en inventario.</b>`;
            document.getElementById("placa-id").value = ""; // Limpiar campo
            
        } catch (e) {
            status.innerText = "‚ùå Error: " + e.message;
        }
    };
</script>
</body>
</html>
